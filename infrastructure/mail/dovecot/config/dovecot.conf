# Mauntic3 Dovecot Configuration
# Minimal setup for LMTP bounce processing
# -----------------------------------------

# Protocols: LMTP for Postfix delivery, IMAP for bounce mailbox access
protocols = lmtp imap

# Logging
log_path = /dev/stderr
info_log_path = /dev/stdout

# Listen on all interfaces
listen = *

# Mail location - maildir format for bounce mailboxes
mail_location = maildir:/var/mail/vhosts/%d/%n

# Authentication
auth_mechanisms = plain login

passdb {
  driver = static
  args = password=bounce-internal-only
}

userdb {
  driver = static
  args = uid=vmail gid=vmail home=/var/mail/vhosts/%d/%n
}

# LMTP service - receives bounced mail from Postfix
service lmtp {
  inet_listener lmtp {
    address = 0.0.0.0
    port = 24
  }

  # Process settings
  process_min_avail = 1
  vsz_limit = 256M
}

# IMAP service
service imap-login {
  inet_listener imap {
    port = 143
  }
  inet_listener imaps {
    port = 993
    ssl = yes
  }
}

# Auth service for Postfix SASL
service auth {
  unix_listener /var/spool/postfix/private/auth {
    mode = 0660
    user = postfix
    group = postfix
  }
}

# LMTP protocol settings
protocol lmtp {
  # Sieve plugin for automated bounce processing
  mail_plugins = $mail_plugins
  postmaster_address = postmaster@localhost
}

# SSL/TLS settings
ssl = yes
ssl_cert = </etc/ssl/certs/ssl-cert-snakeoil.pem
ssl_key = </etc/ssl/private/ssl-cert-snakeoil.key
ssl_min_protocol = TLSv1.2

# Namespace configuration
namespace inbox {
  inbox = yes
  separator = /

  mailbox Bounces {
    auto = subscribe
    special_use = \Junk
  }
}
